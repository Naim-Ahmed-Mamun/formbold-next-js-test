import { useEffect, useRef, useState } from "react";
import { useDispatch, useSelector } from "react-redux";
import {
  formSubmissionsDataExport,
  resetFormSubmissionsDataExport,
} from "../../actions/FormAction";
import Loader from "../Icons/Loader";
import useClickOutside from "../../hooks/useClickOutside";

const SubmissionsTabBar = ({ filters, setFilters,submissionData }) => {
  const dispatch = useDispatch();

  // const submissionsData = useSelector(
  //   (state) => state.forms?.submissions?.data
  // );
  const forms = useSelector((state) => state.forms);
  const submissionsExport = forms?.submissionsExport;
  const currentForm = forms?.currentForm;

  const [showActionMenu, setShowActionMenu] = useState(false);

  // click outside delete popup
  const divRef = useRef(null);
  useClickOutside(divRef, () => setShowActionMenu(false));

  useEffect(() => {
    if (!submissionsExport?.loading && submissionsExport?.requestSucess) {
      dispatch(resetFormSubmissionsDataExport());
    }
  // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [submissionsExport?.loading, submissionsExport?.requestSucess]);


  const handelUpdateFilters = (e, type, value) => {
    e.preventDefault();
    const oldValue = { ...filters };
    if (type == "all") {
      oldValue[type] = value;
      oldValue["spam"] = undefined;
    }
    if (type == "spam") {
      oldValue[type] = value;
      oldValue["all"] = undefined;
    }
    setFilters(oldValue);
  };

  const handelExportSubmission = (e) => {
    e.preventDefault();
    dispatch(
      formSubmissionsDataExport({
        formId: currentForm?.id,
      })
    );
  };

  return (
    <div className="mb-5 flex flex-wrap items-center justify-between rounded-[10px] bg-white p-3.5 shadow-fb-one">
      <div className="inline-flex items-center justify-end space-x-3">
        {/* <div>
          <label htmlFor="select_all" className="select_all text-sm font-medium text-black">
            <input type="checkbox" name="select_all" id="select_all" className="sr-only" />
            <span className="mr-3 inline-flex h-5 w-5 items-center justify-center rounded-md border border-fb-gray-4 bg-fb-gray">
              <span className="icon">
                <svg width="10" height="8" viewBox="0 0 10 8">
                  <path
                    fillRule="evenodd"
                    clipRule="evenodd"
                    d="M9.70643 0.792787C9.8939 0.980314 9.99922 1.23462 9.99922 1.49979C9.99922 1.76495 9.8939 2.01926 9.70643 2.20679L4.70643 7.20679C4.5189 7.39426 4.2646 7.49957 3.99943 7.49957C3.73427 7.49957 3.47996 7.39426 3.29243 7.20679L0.292431 4.20679C0.110272 4.01818 0.00947813 3.76558 0.0117566 3.50339C0.014035 3.24119 0.119204 2.99038 0.304612 2.80497C0.49002 2.61956 0.740832 2.51439 1.00303 2.51211C1.26523 2.50983 1.51783 2.61063 1.70643 2.79279L3.99943 5.08579L8.29243 0.792787C8.47996 0.605316 8.73427 0.5 8.99943 0.5C9.2646 0.5 9.5189 0.605316 9.70643 0.792787Z"
                    fill="white"
                  />
                </svg>
              </span>
            </span>
            Select All
          </label>
        </div> */}
        <div className="inline-flex items-center justify-end space-x-3">
          <button
            onClick={(e) => handelUpdateFilters(e, "all", true)}
            className={`inline-flex items-center justify-center rounded-md px-4 py-2 font-heading text-sm font-medium text-primary ${
              filters.all ? "bg-fb-gray" : "hover:bg-fb-gray"
            }`}
          >
            <span className="pr-2.5">
              <svg
                width="20"
                height="20"
                viewBox="0 0 20 20"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  fillRule="evenodd"
                  clipRule="evenodd"
                  d="M9.95153 1.04199H10.0472C11.9708 1.04198 13.4784 1.04197 14.6546 1.20011C15.8585 1.36198 16.8086 1.69976 17.5542 2.44544C18.2999 3.19111 18.6377 4.14113 18.7996 5.34508C18.9577 6.52132 18.9577 8.02885 18.9577 9.95252V10.0481C18.9577 10.3101 18.9577 10.5644 18.9573 10.8112C18.9575 10.8187 18.9577 10.8261 18.9577 10.8337C18.9577 10.8419 18.9575 10.8501 18.9572 10.8583C18.9544 12.4017 18.9348 13.6497 18.7996 14.6556C18.6377 15.8595 18.2999 16.8095 17.5542 17.5552C16.8086 18.3009 15.8585 18.6387 14.6546 18.8005C13.4784 18.9587 11.9708 18.9587 10.0472 18.9587H9.95154C8.02788 18.9587 6.52034 18.9587 5.3441 18.8005C4.14016 18.6387 3.19014 18.3009 2.44446 17.5552C1.69879 16.8095 1.361 15.8595 1.19914 14.6556C1.06391 13.6497 1.04432 12.4017 1.04149 10.8583C1.04118 10.8501 1.04102 10.8419 1.04102 10.8337C1.04102 10.8261 1.04115 10.8187 1.04141 10.8112C1.04101 10.5644 1.04101 10.3102 1.04102 10.0481V9.95251C1.04101 8.02885 1.041 6.52132 1.19914 5.34508C1.361 4.14113 1.69879 3.19111 2.44446 2.44544C3.19014 1.69976 4.14016 1.36198 5.3441 1.20011C6.52034 1.04197 8.02787 1.04198 9.95153 1.04199ZM2.29393 11.4587C2.3018 12.7108 2.33084 13.692 2.43799 14.489C2.58122 15.5543 2.85363 16.1966 3.32835 16.6713C3.80306 17.146 4.44533 17.4185 5.51066 17.5617C6.59398 17.7073 8.01749 17.7087 9.99935 17.7087C11.9812 17.7087 13.4047 17.7073 14.488 17.5617C15.5534 17.4185 16.1956 17.146 16.6704 16.6713C17.1451 16.1966 17.4175 15.5543 17.5607 14.489C17.6679 13.692 17.6969 12.7108 17.7048 11.4587H15.6991C14.8876 11.4587 14.6754 11.472 14.4973 11.554C14.3192 11.6359 14.1709 11.7883 13.6428 12.4044L13.1383 12.993C13.1137 13.0217 13.0895 13.05 13.0655 13.0781C12.6471 13.5673 12.3157 13.9547 11.857 14.1657C11.3984 14.3766 10.8886 14.3761 10.2448 14.3754C10.2079 14.3754 10.1706 14.3753 10.1329 14.3753H9.8658C9.82805 14.3753 9.79075 14.3754 9.7539 14.3754C9.11014 14.3761 8.6003 14.3766 8.14165 14.1657C7.683 13.9547 7.35161 13.5673 6.93317 13.0781C6.90922 13.05 6.88497 13.0217 6.86041 12.993L6.35589 12.4044C5.82776 11.7883 5.67953 11.6359 5.50139 11.554C5.32325 11.472 5.11107 11.4587 4.29957 11.4587H2.29393ZM17.7077 10.2087H15.6991C15.6614 10.2087 15.6241 10.2086 15.5872 10.2086C14.9435 10.2079 14.4336 10.2074 13.975 10.4183C13.5163 10.6293 13.1849 11.0167 12.7665 11.5059C12.7426 11.5339 12.7183 11.5623 12.6937 11.5909L12.1892 12.1796C11.6611 12.7957 11.5129 12.9481 11.3347 13.03C11.1566 13.112 10.9444 13.1253 10.1329 13.1253H9.8658C9.05429 13.1253 8.84211 13.112 8.66397 13.03C8.48584 12.9481 8.3376 12.7957 7.80948 12.1796L7.30496 11.5909C7.28039 11.5623 7.25615 11.5339 7.23219 11.5059C6.81375 11.0167 6.48236 10.6293 6.02371 10.4183C5.56506 10.2074 5.05522 10.2079 4.41147 10.2086C4.37461 10.2086 4.33732 10.2087 4.29957 10.2087H2.29103C2.29102 10.1399 2.29102 10.0705 2.29102 10.0003C2.29102 8.01847 2.29234 6.59495 2.43799 5.51164C2.58122 4.4463 2.85363 3.80404 3.32835 3.32932C3.80306 2.85461 4.44533 2.5822 5.51066 2.43897C6.59398 2.29332 8.01749 2.29199 9.99935 2.29199C11.9812 2.29199 13.4047 2.29332 14.488 2.43897C15.5534 2.5822 16.1956 2.85461 16.6704 3.32932C17.1451 3.80404 17.4175 4.4463 17.5607 5.51164C17.7064 6.59495 17.7077 8.01847 17.7077 10.0003C17.7077 10.0705 17.7077 10.1399 17.7077 10.2087Z"
                  fill="currentColor"
                />
              </svg>
            </span>
            Inbox ({submissionData?.inboxCount})
          </button>
          <button
            onClick={(e) => handelUpdateFilters(e, "spam", true)}
            className={`py- inline-flex items-center justify-center rounded-md px-4 py-2 font-heading text-sm font-medium text-fb-orange ${
              filters.spam ? "bg-orange-light-6" : "hover:bg-orange-light-6"
            }`}
          >
            <span className="pr-2.5">
              <svg
                width="20"
                height="20"
                viewBox="0 0 20 20"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M9.99935 14.792C10.3445 14.792 10.6243 14.5122 10.6243 14.167V9.16699C10.6243 8.82182 10.3445 8.54199 9.99935 8.54199C9.65417 8.54199 9.37435 8.82182 9.37435 9.16699V14.167C9.37435 14.5122 9.65417 14.792 9.99935 14.792Z"
                  fill="currentColor"
                />
                <path
                  d="M9.99935 5.83366C10.4596 5.83366 10.8327 6.20676 10.8327 6.66699C10.8327 7.12723 10.4596 7.50033 9.99935 7.50033C9.53911 7.50033 9.16602 7.12723 9.16602 6.66699C9.16602 6.20676 9.53911 5.83366 9.99935 5.83366Z"
                  fill="currentColor"
                />
                <path
                  fillRule="evenodd"
                  clipRule="evenodd"
                  d="M1.04102 10.0003C1.04102 5.05277 5.0518 1.04199 9.99935 1.04199C14.9469 1.04199 18.9577 5.05277 18.9577 10.0003C18.9577 14.9479 14.9469 18.9587 9.99935 18.9587C5.0518 18.9587 1.04102 14.9479 1.04102 10.0003ZM9.99935 2.29199C5.74215 2.29199 2.29102 5.74313 2.29102 10.0003C2.29102 14.2575 5.74215 17.7087 9.99935 17.7087C14.2565 17.7087 17.7077 14.2575 17.7077 10.0003C17.7077 5.74313 14.2565 2.29199 9.99935 2.29199Z"
                  fill="currentColor"
                />
              </svg>
            </span>
            Spam ({submissionData?.spamCount})
          </button>
        </div>
      </div>

      <div className="inline-flex items-center justify-end space-x-3">
        {/* <div className="group relative">
          <button
            onClick={() => setShowActionMenu(!showActionMenu)}
            className="inline-flex items-center justify-center rounded-md border border-stroke px-4 py-2 text-sm font-medium text-black focus:bg-fb-gray hover:bg-fb-gray"
          >
            <span className="pr-2.5">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M10.0007 14.1667C10.9211 14.1667 11.6673 14.9129 11.6673 15.8333C11.6673 16.7538 10.9211 17.5 10.0007 17.5C9.08018 17.5 8.33398 16.7538 8.33398 15.8333C8.33398 14.9129 9.08018 14.1667 10.0007 14.1667Z"
                  fill="currentColor"
                />
                <path
                  d="M10.0007 8.33333C10.9211 8.33333 11.6673 9.07953 11.6673 10C11.6673 10.9205 10.9211 11.6667 10.0007 11.6667C9.08018 11.6667 8.33398 10.9205 8.33398 10C8.33398 9.07953 9.08018 8.33333 10.0007 8.33333Z"
                  fill="currentColor"
                />
                <path
                  d="M10.0007 2.5C10.9211 2.5 11.6673 3.24619 11.6673 4.16667C11.6673 5.08714 10.9211 5.83333 10.0007 5.83333C9.08018 5.83333 8.33398 5.08714 8.33398 4.16667C8.33398 3.24619 9.08018 2.5 10.0007 2.5Z"
                  fill="currentColor"
                />
              </svg>
            </span>
            Action
          </button>
          {showActionMenu && (
            <div
              ref={divRef}
              className="absolute right-0 top-[110%] w-[180px] space-y-1.5 rounded-[10px] border border-stroke bg-white p-2.5 shadow-[0px_18px_25px_rgba(113,116,152,0.05)]"
            >
              <button className="flex w-full items-center rounded-md px-3 py-1.5 text-sm font-normal text-body-color hover:bg-fb-gray hover:text-black">
                <span className="pr-2">
                  <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                      fillRule="evenodd"
                      clipRule="evenodd"
                      d="M7.73202 1.68751H10.2681C10.4304 1.68741 10.5718 1.68732 10.7053 1.70864C11.2328 1.79287 11.6892 2.12186 11.9359 2.59563C11.9984 2.71555 12.043 2.84971 12.0942 3.00371L12.1779 3.25488C12.1921 3.2974 12.1962 3.30943 12.1996 3.31891C12.3309 3.682 12.6715 3.92745 13.0575 3.93723C13.0676 3.93748 13.08 3.93753 13.1251 3.93753H15.3751C15.6857 3.93753 15.9376 4.18937 15.9376 4.50003C15.9376 4.81069 15.6857 5.06253 15.3751 5.06253H2.625C2.31434 5.06253 2.0625 4.81069 2.0625 4.50003C2.0625 4.18937 2.31434 3.93753 2.625 3.93753H4.87506C4.9201 3.93753 4.93253 3.93749 4.94267 3.93723C5.32866 3.92745 5.66918 3.68202 5.80052 3.31893C5.80397 3.30938 5.80794 3.29761 5.82218 3.25488L5.90589 3.00372C5.95711 2.84973 6.00174 2.71555 6.06419 2.59563C6.3109 2.12186 6.76735 1.79287 7.29482 1.70864C7.42834 1.68732 7.56973 1.68741 7.73202 1.68751ZM6.75611 3.93753C6.79475 3.86176 6.82898 3.78303 6.85843 3.70161C6.86737 3.67689 6.87615 3.65057 6.88742 3.61675L6.96227 3.39219C7.03065 3.18706 7.04639 3.14522 7.06201 3.11523C7.14424 2.95731 7.29639 2.84764 7.47222 2.81957C7.50561 2.81423 7.55027 2.81253 7.76651 2.81253H10.2336C10.4499 2.81253 10.4945 2.81423 10.5279 2.81957C10.7037 2.84764 10.8559 2.95731 10.9381 3.11523C10.9537 3.14522 10.9695 3.18705 11.0379 3.39219L11.1127 3.61662L11.1417 3.70163C11.1712 3.78304 11.2054 3.86177 11.244 3.93753H6.75611Z"
                      fill="currentColor"
                    />
                    <path
                      d="M4.43632 6.33761C4.41565 6.02764 4.14762 5.79311 3.83765 5.81377C3.52767 5.83444 3.29314 6.10247 3.31381 6.41245L3.6614 11.6262C3.72552 12.5883 3.77731 13.3654 3.89879 13.9752C4.02509 14.6092 4.23991 15.1387 4.6836 15.5538C5.1273 15.9689 5.66996 16.1481 6.31095 16.2319C6.92747 16.3126 7.70628 16.3125 8.67045 16.3125H9.32963C10.2938 16.3125 11.0727 16.3126 11.6892 16.2319C12.3302 16.1481 12.8728 15.9689 13.3165 15.5538C13.7602 15.1387 13.975 14.6092 14.1013 13.9752C14.2228 13.3654 14.2746 12.5883 14.3387 11.6263L14.6863 6.41245C14.707 6.10247 14.4725 5.83444 14.1625 5.81377C13.8525 5.79311 13.5845 6.02764 13.5638 6.33761L13.2189 11.5119C13.1515 12.5228 13.1034 13.2262 12.998 13.7554C12.8958 14.2688 12.753 14.5405 12.5479 14.7323C12.3429 14.9242 12.0623 15.0485 11.5433 15.1164C11.0082 15.1864 10.3032 15.1875 9.29007 15.1875H8.71005C7.69692 15.1875 6.99192 15.1864 6.45686 15.1164C5.93786 15.0485 5.65724 14.9242 5.45218 14.7323C5.24712 14.5405 5.10437 14.2687 5.00211 13.7554C4.89669 13.2262 4.84867 12.5228 4.78127 11.5119L4.43632 6.33761Z"
                      fill="currentColor"
                    />
                    <path
                      d="M7.0691 7.69032C7.37822 7.65941 7.65386 7.88494 7.68478 8.19406L8.05978 11.9441C8.09069 12.2532 7.86516 12.5288 7.55604 12.5597C7.24692 12.5906 6.97127 12.3651 6.94036 12.056L6.56536 8.306C6.53445 7.99688 6.75998 7.72123 7.0691 7.69032Z"
                      fill="currentColor"
                    />
                    <path
                      d="M10.931 7.69032C11.2402 7.72123 11.4657 7.99688 11.4348 8.306L11.0598 12.056C11.0289 12.3651 10.7532 12.5906 10.4441 12.5597C10.135 12.5288 9.90945 12.2532 9.94036 11.9441L10.3154 8.19406C10.3463 7.88494 10.6219 7.65941 10.931 7.69032Z"
                      fill="currentColor"
                    />
                  </svg>
                </span>
                Delete All (1)
              </button>
              <button className="flex w-full items-center rounded-md px-3 py-1.5 text-sm font-normal text-body-color hover:bg-fb-gray hover:text-black">
                <span className="pr-2">
                  <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <g clipPath="url(#clip0_148_5283)">
                      <path
                        d="M9 13.3125C9.31066 13.3125 9.5625 13.0607 9.5625 12.75V8.25C9.5625 7.93934 9.31066 7.6875 9 7.6875C8.68934 7.6875 8.4375 7.93934 8.4375 8.25V12.75C8.4375 13.0607 8.68934 13.3125 9 13.3125Z"
                        fill="currentColor"
                      />
                      <path
                        d="M9 5.25C9.41421 5.25 9.75 5.58579 9.75 6C9.75 6.41421 9.41421 6.75 9 6.75C8.58579 6.75 8.25 6.41421 8.25 6C8.25 5.58579 8.58579 5.25 9 5.25Z"
                        fill="currentColor"
                      />
                      <path
                        fillRule="evenodd"
                        clipRule="evenodd"
                        d="M0.9375 9C0.9375 4.5472 4.5472 0.9375 9 0.9375C13.4528 0.9375 17.0625 4.5472 17.0625 9C17.0625 13.4528 13.4528 17.0625 9 17.0625C4.5472 17.0625 0.9375 13.4528 0.9375 9ZM9 2.0625C5.16852 2.0625 2.0625 5.16852 2.0625 9C2.0625 12.8315 5.16852 15.9375 9 15.9375C12.8315 15.9375 15.9375 12.8315 15.9375 9C15.9375 5.16852 12.8315 2.0625 9 2.0625Z"
                        fill="currentColor"
                      />
                    </g>
                    <defs>
                      <clipPath id="clip0_148_5283">
                        <rect width="18" height="18" fill="white" />
                      </clipPath>
                    </defs>
                  </svg>
                </span>
                Mark as Spam
              </button>
              <button className="flex w-full items-center rounded-md px-3 py-1.5 text-sm font-normal text-body-color hover:bg-fb-gray hover:text-black">
                <span className="pr-2">
                  <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <g clipPath="url(#clip0_148_5288)">
                      <path
                        fillRule="evenodd"
                        clipRule="evenodd"
                        d="M9 0.9375C4.5472 0.9375 0.9375 4.5472 0.9375 9C0.9375 13.4528 4.5472 17.0625 9 17.0625C13.4528 17.0625 17.0625 13.4528 17.0625 9C17.0625 4.5472 13.4528 0.9375 9 0.9375ZM2.0625 9C2.0625 5.16852 5.16852 2.0625 9 2.0625C10.7134 2.0625 12.2817 2.68363 13.492 3.71299C13.487 3.71764 13.4821 3.72239 13.4773 3.72725L3.72727 13.4771C3.72238 13.482 3.7176 13.4869 3.71292 13.492C2.6836 12.2816 2.0625 10.7133 2.0625 9ZM4.50787 14.2869C5.71824 15.3163 7.28658 15.9375 9 15.9375C12.8315 15.9375 15.9375 12.8315 15.9375 9C15.9375 7.28662 15.3164 5.71832 14.287 4.50797C14.2824 4.51296 14.2776 4.51789 14.2727 4.52276L4.52276 14.2726C4.51786 14.2775 4.5129 14.2823 4.50787 14.2869Z"
                        fill="currentColor"
                      />
                    </g>
                    <defs>
                      <clipPath id="clip0_148_5288">
                        <rect width="18" height="18" fill="white" />
                      </clipPath>
                    </defs>
                  </svg>
                </span>
                Unmark Spam
              </button>
            </div>
          )}
        </div> */}

        <button
          className="inline-flex h-9 items-center justify-center rounded-md border border-stroke px-4 text-sm font-medium text-black focus:bg-fb-gray hover:bg-fb-gray"
          onClick={(e) => handelExportSubmission(e)}
        >
          {submissionsExport?.loading ? (
            <Loader show height="25px" size="25px" />
          ) : (
            <>
              <span className="pr-2.5">
                <svg
                  width="20"
                  height="20"
                  viewBox="0 0 20 20"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M10.4613 13.7551C10.3429 13.8846 10.1755 13.9583 10 13.9583C9.82453 13.9583 9.65714 13.8846 9.53873 13.7551L6.2054 10.1092C5.97248 9.85448 5.99019 9.45915 6.24494 9.22623C6.49969 8.99332 6.89502 9.01102 7.12794 9.26577L9.375 11.7235L9.375 2.5C9.375 2.15482 9.65482 1.875 10 1.875C10.3452 1.875 10.625 2.15482 10.625 2.5L10.625 11.7235L12.8721 9.26577C13.105 9.01102 13.5003 8.99332 13.7551 9.22623C14.0098 9.45915 14.0275 9.85448 13.7946 10.1092L10.4613 13.7551Z"
                    fill="currentColor"
                  />
                  <path
                    d="M3.125 12.5C3.125 12.1548 2.84518 11.875 2.5 11.875C2.15482 11.875 1.875 12.1548 1.875 12.5V12.5457C1.87498 13.6854 1.87497 14.604 1.9721 15.3265C2.07295 16.0765 2.2887 16.7081 2.79029 17.2097C3.29189 17.7113 3.92345 17.927 4.67354 18.0279C5.39602 18.125 6.31462 18.125 7.45428 18.125H12.5457C13.6854 18.125 14.604 18.125 15.3265 18.0279C16.0766 17.927 16.7081 17.7113 17.2097 17.2097C17.7113 16.7081 17.9271 16.0765 18.0279 15.3265C18.125 14.604 18.125 13.6854 18.125 12.5457V12.5C18.125 12.1548 17.8452 11.875 17.5 11.875C17.1548 11.875 16.875 12.1548 16.875 12.5C16.875 13.6962 16.8737 14.5304 16.789 15.1599C16.7068 15.7714 16.5565 16.0952 16.3258 16.3258C16.0952 16.5565 15.7714 16.7068 15.1599 16.789C14.5304 16.8737 13.6962 16.875 12.5 16.875H7.5C6.30382 16.875 5.46956 16.8737 4.8401 16.789C4.22862 16.7068 3.90481 16.5565 3.67418 16.3258C3.44354 16.0952 3.29317 15.7714 3.21096 15.1599C3.12633 14.5304 3.125 13.6962 3.125 12.5Z"
                    fill="currentColor"
                  />
                </svg>
              </span>
              Export
            </>
          )}
        </button>
      </div>
    </div>
  );
};

export default SubmissionsTabBar;
